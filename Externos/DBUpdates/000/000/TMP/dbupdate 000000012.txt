UNID

//INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=UNID
DBATUALIZ_OBJETIVO=CRIA UNID
DBATUALIZ_OBS=


/////////////////////////
// SEQUENCE UNID_SEQ
/////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE SEQUENCE
OBJETO_NOME=UNID_SEQ
//VALOR_INICIAL=0
COMANDO FIM
// SEQUENCE UNID_SEQ FIM


/////////////////////////
//
// TABELA UNID
//
/////////////////////////
COMANDO INI

TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=UNID
COLUNAS INI
//NOME,TIPO,NOT NULL,PRIM,UNIQUE

UNID_ID,ID_SHORT_DOM,N,S,N
DESCR,NOME_RED_DOM,S,N,S
SIGLA,VARCHAR(6),S,N,S
COLUNAS FIM
COMANDO FIM

// PACKAGE UNID_PA
COMANDO INI
TIPO_COMANDO=CREATE OR ALTER PACKAGE
OBJETO_NOME=UNID_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE UNID_PA
AS
BEGIN
  PROCEDURE LISTA_GET
  (
    DESCR_BUSCA NOME_RED_DOM
  )
  RETURNS
  (
    UNID_ID SMALLINT
    , DESCR NOME_RED_NOTN_DOM
    , SIGLA VARCHAR(6)
  );
  PROCEDURE BYID_GET
  (
    UNID_ID ID_SHORT_DOM 
  )
  RETURNS
  (
    DESCR NOME_RED_DOM
    , SIGLA VARCHAR(6)
  );
  PROCEDURE UNID_GARANTIR
  (
    UNID_ID ID_SHORT_DOM
    , DESCR NOME_RED_NOTN_DOM
    , SIGLA VARCHAR(6) NOT NULL
  )  
  RETURNS
  (
    UNID_ID_GRAVADA SMALLINT
  );

  PROCEDURE BYDESCR_GET
  (
    DESCR NOME_RED_DOM
    , SIGLA VARCHAR(6)
  )
  RETURNS
  (
    UNID_ID SMALLINT
    , DESCR_RET NOME_RED_DOM
    , SIGLA_RET VARCHAR(6)
  );

END^

RECREATE PACKAGE BODY UNID_PA
AS
BEGIN
  PROCEDURE LISTA_GET
  (
    DESCR_BUSCA NOME_RED_DOM
  )
  RETURNS
  (
    UNID_ID SMALLINT
    , DESCR NOME_RED_NOTN_DOM
    , SIGLA VARCHAR(6)
  )
  AS 
  BEGIN 
    IF (TRIM(DESCR_BUSCA) = '') THEN 
      FOR SELECT UN.UNID_ID, UN.DESCR, UN.SIGLA FROM UNID UN INTO :UNID_ID, :DESCR, :SIGLA DO SUSPEND; 
    ELSE 
      FOR SELECT UN.UNID_ID, UN.DESCR, UN.SIGLA FROM UNID UN WHERE UN.DESCR LIKE '%'||:DESCR_BUSCA||'%' OR UN.SIGLA LIKE '%'||:DESCR_BUSCA||'%'  INTO :UNID_ID, :DESCR, :SIGLA DO SUSPEND; 
  END

   PROCEDURE BYID_GET
  (
    UNID_ID ID_SHORT_DOM 
  )
  RETURNS
  (
    DESCR NOME_RED_DOM
    , SIGLA VARCHAR(6)
  )
  AS  
  BEGIN  
    SELECT FIRST(1) UN.DESCR, UN.SIGLA FROM UNID UN WHERE UN.UNID_ID = :UNID_ID INTO :DESCR, :SIGLA;
    SUSPEND;
  END
  
  PROCEDURE UNID_GARANTIR
  (
    UNID_ID ID_SHORT_DOM
    , DESCR NOME_RED_NOTN_DOM
    , SIGLA VARCHAR(6) NOT NULL
  )
  RETURNS
  (
    UNID_ID_GRAVADA SMALLINT
  )
  AS
  BEGIN
    IF (UNID_ID < 1) THEN
    BEGIN
      UNID_ID_GRAVADA = NEXT VALUE FOR UNID_SEQ;
  	END
    ELSE
    BEGIN
	    UNID_ID_GRAVADA = UNID_ID;
    END	
	
    UPDATE OR INSERT INTO UNID (UNID_ID, DESCR, SIGLA)
    VALUES (:UNID_ID_GRAVADA, :DESCR, :SIGLA)
    MATCHING (UNID_ID);
    SUSPEND;
  END

  PROCEDURE BYDESCR_GET
  (
    DESCR NOME_RED_DOM
    , SIGLA VARCHAR(6)
  )
  RETURNS
  (
    UNID_ID SMALLINT
    , DESCR_RET NOME_RED_DOM
    , SIGLA_RET VARCHAR(6)
  )
  AS
  BEGIN
    SELECT UNID_ID, DESCR, SIGLA FROM UNID WHERE DESCR = :DESCR OR SIGLA = :SIGLA INTO :UNID_ID, DESCR, SIGLA;
    SUSPEND;
  END
END^
SET TERM ;^
```
COMANDO FIM


DBATUALIZ FIM
