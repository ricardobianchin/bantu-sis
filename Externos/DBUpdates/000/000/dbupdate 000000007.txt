PERFIL_USO


//INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=PERFIL_USO
DBATUALIZ_OBJETIVO=CRIA PERFIL_USO
DBATUALIZ_OBS=



/////////////////////////
//
// TABELA PERFIL_USO
//
/////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=PERFIL_USO
COLUNAS INI

//NOME;TIPO;NOT NULL;PRIM
PERFIL_USO_ID;ID_SHORT_DOM;S;S
NOME;NOME_REDU_NOTN_DOM
DE_SISTEMA;BOOLEAN NOT NULL

COLUNAS FIM
COMANDO FIM





/////////////////////////
//
// TABELA PERFIL_USO_ACESSA_MODULO
//
/////////////////////////
COMANDO INI

TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=PERFIL_USO_ACESSA_MODULO
COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM

PERFIL_USO_ID;ID_SHORT_DOM;S;S
MODULO_ID;ID_CHAR_DOM;S;S

COLUNAS FIM
COMANDO FIM




//////////////////////////////////
//
// FOREIGN KEY PERFIL_USO_ACESSA_MODULO X PERFIL_USO
//
//////////////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE FOREIGN KEY
//OBJETO_NOME=
TABELA_FK=PERFIL_USO_ACESSA_MODULO
CAMPOS_FK=PERFIL_USO_ID
TABELA_PK=PERFIL_USO
//CAMPOS_PK=
COMANDO FIM
//OBJETO_NOME e CAMPOS_PK nao sao obrigatorios
// FOREIGN KEY PERFIL_USO ACESSA MODULO





//////////////////////////////////
//
// FOREIGN KEY PERFIL_USO_ACESSA_MODULO X MODULO
//
//////////////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE FOREIGN KEY
//OBJETO_NOME=
TABELA_FK=PERFIL_USO_ACESSA_MODULO
CAMPOS_FK=MODULO_ID
TABELA_PK=MODULO
//CAMPOS_PK=
COMANDO FIM
//OBJETO_NOME e CAMPOS_PK nao sao obrigatorios
// FOREIGN KEY USUARIO PESSOA FIM











//PACKAGE PERFIL_USO_PA

COMANDO INI
TIPO_COMANDO=CREATE OR ALTER PACKAGE
OBJETO_NOME=PERFIL_USO_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE PERFIL_USO_PA
AS
BEGIN
  PROCEDURE PERFIL_USO_GARANTIR(
    PERFIL_USO_ID ID_SHORT_NOTN_DOM
    , NOME NOME_REDU_NOTN_DOM
    , DE_SISTEMA BOOLEAN NOT NULL
  );

  PROCEDURE PERFIL_USO_ACESSA_MODULO_GARANTIR(
    PERFIL_USO_ID ID_SHORT_NOTN_DOM
    , MODULO_ID ID_CHAR_NOTN_DOM
  );

  PROCEDURE PERFIL_USO_MODULOS_GET
  (
    PERFIL_USO_ID ID_SHORT_NOTN_DOM
  )
  RETURNS
  (
    MODULO_ID CHAR
    , DESCR NOME_CURTO_DOM
  );
END^

RECREATE PACKAGE BODY PERFIL_USO_PA
AS
BEGIN
  PROCEDURE PERFIL_USO_GARANTIR(
    PERFIL_USO_ID ID_SHORT_NOTN_DOM
    , NOME NOME_REDU_NOTN_DOM
    , DE_SISTEMA BOOLEAN NOT NULL
  )
  AS
  BEGIN
    UPDATE OR INSERT INTO PERFIL_USO (PERFIL_USO_ID, NOME, DE_SISTEMA)
    VALUES (:PERFIL_USO_ID, :NOME, :DE_SISTEMA)
    MATCHING (PERFIL_USO_ID);
  END

  PROCEDURE PERFIL_USO_ACESSA_MODULO_GARANTIR(
    PERFIL_USO_ID ID_SHORT_NOTN_DOM
    , MODULO_ID ID_CHAR_NOTN_DOM
  )
  AS
  BEGIN
    UPDATE OR INSERT INTO PERFIL_USO_ACESSA_MODULO (PERFIL_USO_ID, MODULO_ID)
    VALUES (:PERFIL_USO_ID, :MODULO_ID)
    MATCHING (PERFIL_USO_ID, MODULO_ID);
  END

  PROCEDURE PERFIL_USO_MODULOS_GET(PERFIL_USO_ID ID_SHORT_NOTN_DOM)
  RETURNS (MODULO_ID CHAR, DESCR NOME_CURTO_DOM)
  AS 
  BEGIN 
    FOR SELECT M.MODULO_ID, M.DESCR
    FROM MODULO M
    JOIN PERFIL_USO_ACESSA_MODULO P ON P.MODULO_ID = M.MODULO_ID
    WHERE P.PERFIL_USO_ID = :PERFIL_USO_ID
    INTO :MODULO_ID, :DESCR
    DO SUSPEND; 
  END
END^
SET TERM ;^
```
COMANDO FIM
//PACKAGE PERFIL_USO_PA FIM


DBATUALIZ FIM
