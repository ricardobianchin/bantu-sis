CRIA
TERMINAL_PA


INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=AMBIENTE, TERMINAL_PA
DBATUALIZ_OBJETIVO=CRIAR PACKAGE TERMINAL_PA
DBATUALIZ_OBS=



// PACKAGE TERMINAL_PA
COMANDO INI
COMANDO_TIPO=CREATE OR ALTER PACKAGE
OBJETO_NOME=TERMINAL_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE TERMINAL_PA
AS
BEGIN
  PROCEDURE GARANTIR (
    TERMINAL_ID ID_SHORT_DOM,
    APELIDO NOME_REDU_DOM,
    NOME_NA_REDE VARCHAR(15),
    IP IPV6_DOM,
    NF_SERIE SMALLINT,
    LETRA_DO_DRIVE CHAR(1),
    GAVETA_TEM BOOLEAN,
    BALANCA_MODO_ID ID_SHORT_DOM,
    BALANCA_ID ID_SHORT_DOM,
    BARRAS_COD_INI SMALLINT,
    BARRAS_COD_TAM SMALLINT,
    CUPOM_NLINS_FINAL SMALLINT,
    SEMPRE_OFFLINE BOOLEAN,
    PESSOA_ID ID_DOM,
    MACHINE_ID ID_SHORT_DOM
  );
END^
/*
----------
BODY
----------
*/
RECREATE PACKAGE BODY TERMINAL_PA
AS
BEGIN
  PROCEDURE GARANTIR 
  (
    TERMINAL_ID ID_SHORT_DOM,
    APELIDO NOME_REDU_DOM,
    NOME_NA_REDE VARCHAR(15),
    IP IPV6_DOM,
    NF_SERIE SMALLINT,
    LETRA_DO_DRIVE CHAR(1),
    GAVETA_TEM BOOLEAN,
    BALANCA_MODO_ID ID_SHORT_DOM,
    BALANCA_ID ID_SHORT_DOM,
    BARRAS_COD_INI SMALLINT,
    BARRAS_COD_TAM SMALLINT,
    CUPOM_NLINS_FINAL SMALLINT,
    SEMPRE_OFFLINE BOOLEAN,
    LOJA_ID ID_SHORT_DOM,
    PESSOA_ID ID_DOM,
    MACHINE_ID ID_SHORT_DOM
  )
  AS
    // VARS LOG VAR LOG VARLOG VARSLOG terminal
    DECLARE FEATURE_ID ID_SHORT_DOM = 1;//TERMINAIS
    DECLARE RETAGUARDA_TERMINAL_ID ID_SHORT_DOM = 0;
    DECLARE RETAGUARDA_MODULO_ID ID_CHAR_DOM = ASCII_CHAR(34);
    DECLARE ACAO_SIS_ID ID_CHAR_DOM = ASCII_CHAR(39);//GARANTIR
    DECLARE LOG_ID_RET BIGINT;
  BEGIN
    UPDATE OR INSERT INTO TERMINAL (
      TERMINAL_ID, APELIDO, NOME_NA_REDE, IP, NF_SERIE, LETRA_DO_DRIVE, 
      GAVETA_TEM, BALANCA_MODO_ID, BALANCA_ID, BARRAS_COD_INI, BARRAS_COD_TAM, 
      CUPOM_NLINS_FINAL, SEMPRE_OFFLINE
    ) VALUES (
      :TERMINAL_ID, :APELIDO, :NOME_NA_REDE, :IP, :NF_SERIE, :LETRA_DO_DRIVE, 
      :GAVETA_TEM, :BALANCA_MODO_ID, :BALANCA_ID, :BARRAS_COD_INI, :BARRAS_COD_TAM, 
      :CUPOM_NLINS_FINAL, :SEMPRE_OFFLINE
    ) MATCHING (TERMINAL_ID);

    SELECT LOG_ID_RET 
    FROM LOG_PA.LOG_NOVO_GET
    (
      :LOJA_ID,
      :RETAGUARDA_TERMINAL_ID,
      :PESSOA_ID,
      :RETAGUARDA_MODULO_ID,
      :ACAO_SIS_ID,
      :FEATURE_ID,
      :MACHINE_ID
    ) INTO :LOG_ID_RET;

    EXECUTE PROCEDURE LOG_PA.LOG_PK_INS
    (
      :LOJA_ID,
      :RETAGUARDA_TERMINAL_ID,
      :LOG_ID_RET,

      0, //PK_LOJA_ID SMALLINT,
      TERMINAL_ID, //PK_TERMINAL_ID SMALLINT,
      0, //PK_ID BIGINT,
      0 //PK_ORDEM SMALLINT
    );
    END;
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
