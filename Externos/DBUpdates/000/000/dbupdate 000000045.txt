IMPORT ICMS

//INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=CRIA IMPORTACAO ICMS
DBATUALIZ_OBJETIVO=CRIA IMPORT_ICMS E IMPORT_ICMS_PA
DBATUALIZ_OBS=






///////////////////////////////////////////
// SEQUENCE IMPORT_ICMS_SEQ
///////////////////////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE SEQUENCE
OBJETO_NOME=IMPORT_ICMS_SEQ
//VALOR_INICIAL=3
COMANDO FIM
// SEQUENCE IMPORT_ICMS_SEQ FIM






///////////////////////////////////////////
// TABELA IMPORT_ICMS
///////////////////////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=IMPORT_ICMS

COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

//NOME    TIPO    NOTNULL    PRIM    UNIQUE
IMPORT_ICMS_ID;ID_DOM;S;S
ICMS_ID;ID_SHORT_DOM
ICMS_PERC_DESCR;CHAR(10)

COLUNAS FIM
COMANDO FIM
//TABELA IMPORT_ICMS FIM






// PACKAGE 
COMANDO INI
TIPO_COMANDO=CREATE OR ALTER PACKAGE
OBJETO_NOME=IMPORT_ICMS_PA

/*
Complementos\Est\prod_pa.txt

C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\import_ICMS_pa.sql
in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\import_ICMS_pa.sql";
*/

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE IMPORT_ICMS_PA
AS
BEGIN
  PROCEDURE GARANTIR_ID_DESCR
  (
    ICMS_PERC_DESCR CHAR(10) NOT NULL, 
    ICMS_ID ID_SHORT_DOM
  )
  RETURNS
  (
    IMPORT_ICMS_ID ID_DOM
  );
  
  PROCEDURE APAGAR_DO;
END^

----- body -----

RECREATE PACKAGE BODY IMPORT_ICMS_PA
AS
BEGIN
  PROCEDURE GARANTIR_ID_DESCR
  (
    ICMS_PERC_DESCR CHAR(10) NOT NULL,
    ICMS_ID ID_SHORT_DOM
  )
  RETURNS 
  (
    IMPORT_ICMS_ID ID_DOM
  )
  AS
  BEGIN
    SELECT IMPORT_ICMS_ID FROM IMPORT_ICMS WHERE ICMS_PERC_DESCR = :ICMS_PERC_DESCR INTO :IMPORT_ICMS_ID;
    
    IF (IMPORT_ICMS_ID IS NOT NULL) THEN
    BEGIN
      UPDATE IMPORT_ICMS SET ICMS_ID = :ICMS_ID WHERE IMPORT_ICMS_ID = :IMPORT_ICMS_ID;
    END
    ELSE
    BEGIN
      IMPORT_ICMS_ID = NEXT VALUE FOR IMPORT_ICMS_SEQ;
      INSERT INTO IMPORT_ICMS (IMPORT_ICMS_ID, ICMS_PERC_DESCR, ICMS_ID) VALUES (:IMPORT_ICMS_ID, :ICMS_PERC_DESCR, :ICMS_ID);
    END
    SUSPEND;
  END
  
  PROCEDURE APAGAR_DO
  AS
  BEGIN
    EXECUTE STATEMENT('ALTER SEQUENCE IMPORT_ICMS_SEQ RESTART WITH 4;');
    DELETE FROM IMPORT_ICMS WHERE ICMS_ID >= 4;
  END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
