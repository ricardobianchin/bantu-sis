FUNCIONARIO
    inicio

-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=FUNCIONARIO
DBATUALIZ_OBJETIVO=CRIA TABELA FUNCIONARIO E FUNCIONARIO_PA
DBATUALIZ_OBS=


/////////////////////////
//
// TABELA FUNCIONARIO
//
/////////////////////////
COMANDO INI

TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=FUNCIONARIO
COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM

LOJA_ID;ID_SHORT_DOM;S;S
TERMINAL_ID;ID_SHORT_DOM;S;S
PESSOA_ID;ID_DOM;S;S

COLUNAS FIM
COMANDO FIM

//////////////////////////////////
//
// FOREIGN KEY FUNCIONARIO PESSOA
//
//////////////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE FOREIGN KEY
//OBJETO_NOME=
TABELA_FK=FUNCIONARIO
CAMPOS_FK=LOJA_ID,TERMINAL_ID,PESSOA_ID
TABELA_PK=PESSOA
//CAMPOS_PK=
COMANDO FIM
//OBJETO_NOME e CAMPOS_PK nao sao obrigatorios
// FOREIGN KEY FUNCIONARIO PESSOA FIM


//PACKAGE FUNCIONARIO_PA

COMANDO INI
TIPO_COMANDO=CREATE OR ALTER PACKAGE
OBJETO_NOME=FUNCIONARIO_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE FUNCIONARIO_PA
AS
BEGIN

  PROCEDURE GARANTIR_NOMES
  (
    LOJA_ID ID_SHORT_NOTN_DOM,
    NOME NOME_DOM NOT NULL,
    APELIDO VARCHAR(20) NOT NULL,
    PESSOA_ID INTEGER 
  )
  RETURNS
  (
    PESSOA_ID_RETORNADA INTEGER 
  );

  PROCEDURE GARANTIR
  (
    LOJA_ID SMALLINT NOT NULL,
    NOME VARCHAR(60),
    APELIDO VARCHAR(20),
    NOME_FANTASIA VARCHAR(60),
    GENERO_ID CHAR(1),
    ESTADO_CIVIL_ID CHAR(1),
    C VARCHAR(15),
    I VARCHAR(15),
    M VARCHAR(15),
    M_UF CHAR(2),
    EMAIL VARCHAR(50),
    DT_NASC DATE,
    PESSOA_ID INTEGER
  )
  RETURNS
  (
    PESSOA_ID_RETORNADA INTEGER
  );
END^

RECREATE PACKAGE BODY FUNCIONARIO_PA
AS
BEGIN
  PROCEDURE GARANTIR_NOMES
  (
    LOJA_ID ID_SHORT_NOTN_DOM,
    NOME NOME_DOM NOT NULL,
    APELIDO VARCHAR(20) NOT NULL,
    PESSOA_ID INTEGER 
  )
  RETURNS
  (
    PESSOA_ID_RETORNADA INTEGER 
  )
  AS
  BEGIN
    EXECUTE PROCEDURE PESSOA_PA.GARANTIR_NOMES(:LOJA_ID, 0, :NOME, :APELIDO, :PESSOA_ID)
      RETURNING_VALUES :PESSOA_ID_RETORNADA;
    
    UPDATE OR INSERT INTO FUNCIONARIO (LOJA_ID, TERMINAL_ID, PESSOA_ID)
    VALUES (:LOJA_ID, 0, :PESSOA_ID_RETORNADA)
    MATCHING (LOJA_ID, TERMINAL_ID, PESSOA_ID);
    
    SUSPEND; -- RETORNA O VALOR DE PESSOA_ID_RETORNADA
  END

  PROCEDURE GARANTIR
  (
    LOJA_ID SMALLINT NOT NULL,
    NOME VARCHAR(60),
    APELIDO VARCHAR(20),
    NOME_FANTASIA VARCHAR(60),
    GENERO_ID CHAR(1),
    ESTADO_CIVIL_ID CHAR(1),
    C VARCHAR(15),
    I VARCHAR(15),
    M VARCHAR(15),
    M_UF CHAR(2),
    EMAIL VARCHAR(50),
    DT_NASC DATE,
    PESSOA_ID INTEGER
  )
  RETURNS
  (
    PESSOA_ID_RETORNADA INTEGER
  )
  AS
  BEGIN
    EXECUTE PROCEDURE PESSOA_PA.GARANTIR(:LOJA_ID, 0, :NOME, :NOME_FANTASIA, :APELIDO, :GENERO_ID, :ESTADO_CIVIL_ID, :C, :I, :M, :M_UF, :EMAIL, :DT_NASC, :PESSOA_ID)
      RETURNING_VALUES :PESSOA_ID_RETORNADA;

    UPDATE OR INSERT INTO FUNCIONARIO (LOJA_ID, TERMINAL_ID, PESSOA_ID)
    VALUES (:LOJA_ID, 0, :PESSOA_ID_RETORNADA)
    MATCHING (LOJA_ID, TERMINAL_ID, PESSOA_ID);

    SUSPEND; -- RETORNA O VALOR DE PESSOA_ID_RETORNADA
  END

END^
SET TERM ;^
```
COMANDO FIM
//PACKAGE FUNCIONARIO_PA FIM
