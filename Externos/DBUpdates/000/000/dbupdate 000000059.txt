IMPORT UNID

//INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=CRIA IMPORTACAO UNID
DBATUALIZ_OBJETIVO=CRIA IMPORT_UNID E IMPORT_UNID_PA
DBATUALIZ_OBS=






///////////////////////////////////////////
// SEQUENCE IMPORT_UNID_SEQ
///////////////////////////////////////////
COMANDO INI
COMANDO_TIPO=CREATE SEQUENCE
OBJETO_NOME=IMPORT_UNID_SEQ
//VALOR_INICIAL=3
COMANDO FIM
// SEQUENCE IMPORT_UNID_SEQ FIM






///////////////////////////////////////////
// TABELA IMPORT_UNID
///////////////////////////////////////////
COMANDO INI
COMANDO_TIPO=CREATE TABLE
OBJETO_NOME=IMPORT_UNID

COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

//NOME    TIPO    NOTNULL    PRIM    UNIQUE
IMPORT_UNID_ID;ID_DOM;S;S
UNID_ID;ID_SHORT_DOM
UNID_SIGLA;CHAR(6)

COLUNAS FIM
COMANDO FIM
//TABELA IMPORT_UNID FIM






// PACKAGE 
COMANDO INI
COMANDO_TIPO=CREATE OR ALTER PACKAGE
OBJETO_NOME=IMPORT_UNID_PA

/*
Complementos\Est\prod_pa.txt

C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\import_UNID_pa.sql
in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\import_UNID_pa.sql";
*/

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE IMPORT_UNID_PA
AS
BEGIN
  PROCEDURE GARANTIR_ID_DESCR
  (
    UNID_SIGLA CHAR(6) NOT NULL, 
    UNID_ID ID_SHORT_DOM
  )
  RETURNS
  (
    IMPORT_UNID_ID ID_DOM
  );
  
  PROCEDURE APAGAR_DO;
END^

----- body -----

RECREATE PACKAGE BODY IMPORT_UNID_PA
AS
BEGIN
  PROCEDURE GARANTIR_ID_DESCR
  (
    UNID_SIGLA CHAR(6) NOT NULL,
    UNID_ID ID_SHORT_DOM
  )
  RETURNS 
  (
    IMPORT_UNID_ID ID_DOM
  )
  AS
  BEGIN
    SELECT IMPORT_UNID_ID FROM IMPORT_UNID WHERE UNID_SIGLA = :UNID_SIGLA INTO :IMPORT_UNID_ID;
    
    IF (IMPORT_UNID_ID IS NOT NULL) THEN
    BEGIN
      UPDATE IMPORT_UNID SET UNID_ID = :UNID_ID WHERE IMPORT_UNID_ID = :IMPORT_UNID_ID;
    END
    ELSE
    BEGIN
      IMPORT_UNID_ID = NEXT VALUE FOR IMPORT_UNID_SEQ;
      INSERT INTO IMPORT_UNID (IMPORT_UNID_ID, UNID_SIGLA, UNID_ID) VALUES (:IMPORT_UNID_ID, :UNID_SIGLA, :UNID_ID);
    END
    SUSPEND;
  END
  
  PROCEDURE APAGAR_DO
  AS
  BEGIN
    EXECUTE STATEMENT('ALTER SEQUENCE IMPORT_UNID_SEQ RESTART WITH 1;');
    DELETE FROM IMPORT_UNID;
  END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
