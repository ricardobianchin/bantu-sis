LOJA

DOMAINS
-------
SELECIONADO_DOM
NOME_INTERM_DOM

TABELAS
-------
LOJA
TERMINAL

PACKAGES
-------
LOJA_PA

INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=LOJA
DBATUALIZ_OBJETIVO=CRIAR LOJA, PACKAGE LOJA_PA, SELECIONADO_DOM
DBATUALIZ_OBS=

// DOMAINS
COMANDO INI
TIPO_COMANDO=CREATE DOMAINS

```FIREBIRD
CREATE DOMAIN SELECIONADO_DOM AS BOOLEAN DEFAULT FALSE NOT NULL;
CREATE DOMAIN NOME_INTERM_DOM AS VARCHAR(40);
CREATE DOMAIN NOME_INTERM_NOTN_DOM AS VARCHAR(40) NOT NULL;
```
COMANDO FIM



// TABELA LOJA
COMANDO INI
TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=LOJA

COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM

LOJA_ID;ID_SHORT_DOM;N;S
APELIDO;NOME_RED_NOTN_DOM
ATIVA;SELECIONADO_DOM

COLUNAS FIM
COMANDO FIM



// TABELA TERMINAL
COMANDO INI

TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=TERMINAL
COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM

TERMINAL_ID;ID_SHORT_DOM;N;S
APELIDO;NOME_RED_DOM
SERVIDOR;NOME_INTERM_DOM
ARQ_DADOS;PATH_DOM
SEMPRE_OFFLINE;BOOLEAN DEFAULT FALSE

COLUNAS FIM
COMANDO FIM



// PACKAGE LOJA_PA
COMANDO INI
TIPO_COMANDO=CREATE OR ALTER PACKAGE
OBJETO_NOME=LOJA_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE LOJA_PA
AS
BEGIN
  PROCEDURE INS
  (
    LOJA_ID ID_SHORT_DOM
    , APELIDO NOME_RED_NOTN_DOM
    , ATIVA SELECIONADO_DOM
  );  
  PROCEDURE ATIVA_GET
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_RED_DOM
  );
  PROCEDURE LISTA_GET
  (
    APELIDO_BUSCA NOME_RED_DOM
  )
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_RED_DOM
    , ATIVA BOOLEAN
  );
  PROCEDURE LOJA_SET
  (
    LOJA_ID ID_SHORT_DOM
    , APELIDO NOME_RED_NOTN_DOM
    , ATIVA SELECIONADO_DOM
  );
  PROCEDURE BYID_GET
  (
    LOJA_ID ID_SHORT_DOM 
  )
  RETURNS
  (
    APELIDO NOME_RED_DOM
    , ATIVA BOOLEAN
  );
  PROCEDURE LOJA_GARANTIR
  (
    LOJA_ID ID_SHORT_DOM
    , APELIDO NOME_RED_NOTN_DOM
    , ATIVA SELECIONADO_DOM
  );
END^

RECREATE PACKAGE BODY LOJA_PA
AS
BEGIN
  PROCEDURE INS
  (
    LOJA_ID ID_SHORT_DOM 
    , APELIDO NOME_RED_NOTN_DOM
    , ATIVA SELECIONADO_DOM
  )
  AS
  BEGIN
    INSERT INTO LOJA(
      LOJA_ID
      , APELIDO
      , ATIVA
    )VALUES(
      :LOJA_ID
      , :APELIDO
      , :ATIVA
    );
  END
  PROCEDURE ATIVA_GET
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_RED_DOM
  )
  AS
  BEGIN
    FOR SELECT L.LOJA_ID, L.APELIDO FROM LOJA L WHERE L.ATIVA = TRUE 
    INTO :LOJA_ID, :APELIDO 
    DO 
    SUSPEND;
  END
  PROCEDURE LISTA_GET
  (
    APELIDO_BUSCA NOME_RED_DOM
  )
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_RED_DOM
    , ATIVA BOOLEAN
  )
  AS 
  BEGIN 
    IF (TRIM(APELIDO_BUSCA) = '') THEN 
      FOR SELECT L.LOJA_ID, L.APELIDO, L.ATIVA FROM LOJA L INTO :LOJA_ID, :APELIDO, :ATIVA DO SUSPEND; 
    ELSE 
      FOR SELECT L.LOJA_ID, L.APELIDO, L.ATIVA FROM LOJA L WHERE L.APELIDO LIKE '%'||:APELIDO_BUSCA||'%' INTO :LOJA_ID, :APELIDO, :ATIVA DO SUSPEND; 
  END
  
  PROCEDURE LOJA_SET 
  (
    LOJA_ID ID_SHORT_DOM
    , APELIDO NOME_RED_NOTN_DOM
    , ATIVA SELECIONADO_DOM
  )
   AS 
   BEGIN 
     UPDATE LOJA SET APELIDO = :APELIDO, ATIVA = :ATIVA WHERE LOJA_ID = :LOJA_ID; 
   END

   PROCEDURE BYID_GET
  (
    LOJA_ID ID_SHORT_DOM 
  )
  RETURNS
  (
    APELIDO NOME_RED_DOM
    , ATIVA BOOLEAN
  )
  AS  
  BEGIN  
    SELECT FIRST(1) L.APELIDO, L.ATIVA FROM LOJA L WHERE L.LOJA_ID = :LOJA_ID INTO :APELIDO, :ATIVA;  
    SUSPEND;
  END
  
  PROCEDURE LOJA_GARANTIR
  (
    LOJA_ID ID_SHORT_DOM
    , APELIDO NOME_RED_NOTN_DOM
    , ATIVA SELECIONADO_DOM
  )
  AS
  BEGIN
    UPDATE OR INSERT INTO LOJA (LOJA_ID, APELIDO, ATIVA)
    VALUES (:LOJA_ID, :APELIDO, :ATIVA)
    MATCHING (LOJA_ID);
  END

END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
