LOJA

DOMAINS
-------
SELECIONADO_DOM
NOME_INTERM_DOM

TABELAS
-------
LOJA
TERMINAL

PACKAGES
-------
LOJA_INICIAL_PA

INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=LOJA
DBATUALIZ_OBJETIVO=CRIAR LOJA, PACKAGE LOJA_INICIAL_PA, SELECIONADO_DOM
DBATUALIZ_OBS=

// DOMAINS
COMANDO INI
TIPO_COMANDO=CREATE DOMAINS

```FIREBIRD
CREATE DOMAIN SELECIONADO_DOM AS BOOLEAN DEFAULT FALSE;
CREATE DOMAIN NOME_INTERM_DOM AS VARCHAR(40);
CREATE DOMAIN NOME_INTERM_NOTN_DOM AS VARCHAR(40) NOT NULL;
```
COMANDO FIM



// TABELA LOJA
COMANDO INI
TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=LOJA

COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

//NOME    TIPO    NOTNULL    PRIM    UNIQUE

LOJA_ID;ID_SHORT_DOM;S;S;N
APELIDO;NOME_REDU_DOM;S;N;S
ATIVO;SELECIONADO_DOM

COLUNAS FIM
COMANDO FIM



// TABELA TERMINAL
COMANDO INI

TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=TERMINAL
COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

//NOME    TIPO    NOTNULL    PRIM    UNIQUE

TERMINAL_ID;ID_SHORT_DOM;S;S
NUM_EXIB;ID_SHORT_DOM;S
APELIDO;NOME_REDU_DOM
NOME_NA_REDE;NOME_INTERM_DOM
ARQ_DADOS;PATH_DOM
SEMPRE_OFFLINE;BOOLEAN DEFAULT FALSE

COLUNAS FIM
COMANDO FIM



// PACKAGE LOJA_INICIAL_PA
COMANDO INI
TIPO_COMANDO=CREATE OR ALTER PACKAGE
OBJETO_NOME=LOJA_INICIAL_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE LOJA_INICIAL_PA
AS
BEGIN
  PROCEDURE INS
  (
    LOJA_ID ID_SHORT_NOTN_DOM
    , APELIDO NOME_REDU_NOTN_DOM
    , ATIVO SELECIONADO_DOM NOT NULL
  );  
  PROCEDURE ATIVO_GET
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_REDU_DOM
  );
  PROCEDURE LISTA_GET
  (
    APELIDO_BUSCA NOME_REDU_DOM
  )
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_REDU_DOM
    , ATIVO BOOLEAN
  );
  PROCEDURE LOJA_SET
  (
    LOJA_ID ID_SHORT_NOTN_DOM
    , APELIDO NOME_REDU_NOTN_DOM
    , ATIVO SELECIONADO_DOM NOT NULL
  );
  PROCEDURE BYID_GET
  (
    LOJA_ID ID_SHORT_NOTN_DOM 
  )
  RETURNS
  (
    APELIDO NOME_REDU_DOM
    , ATIVO BOOLEAN
  );
  PROCEDURE GARANTIR
  (
    LOJA_ID ID_SHORT_NOTN_DOM
    , APELIDO NOME_REDU_NOTN_DOM
    , ATIVO SELECIONADO_DOM NOT NULL
  );
END^

RECREATE PACKAGE BODY LOJA_INICIAL_PA
AS
BEGIN
  PROCEDURE INS
  (
    LOJA_ID ID_SHORT_NOTN_DOM 
    , APELIDO NOME_REDU_NOTN_DOM
    , ATIVO SELECIONADO_DOM NOT NULL
  )
  AS
  BEGIN
    INSERT INTO LOJA(
      LOJA_ID
      , APELIDO
      , ATIVO
    )VALUES(
      :LOJA_ID
      , :APELIDO
      , :ATIVO
    );
  END
  PROCEDURE ATIVO_GET
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_REDU_DOM
  )
  AS
  BEGIN
    FOR SELECT L.LOJA_ID, L.APELIDO FROM LOJA L WHERE L.ATIVO = TRUE 
    INTO :LOJA_ID, :APELIDO 
    DO 
    SUSPEND;
  END
  PROCEDURE LISTA_GET
  (
    APELIDO_BUSCA NOME_REDU_DOM
  )
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_REDU_DOM
    , ATIVO BOOLEAN
  )
  AS 
  BEGIN 
    IF (TRIM(APELIDO_BUSCA) = '') THEN 
      FOR SELECT L.LOJA_ID, L.APELIDO, L.ATIVO FROM LOJA L INTO :LOJA_ID, :APELIDO, :ATIVO DO SUSPEND; 
    ELSE 
      FOR SELECT L.LOJA_ID, L.APELIDO, L.ATIVO FROM LOJA L WHERE L.APELIDO LIKE '%'||:APELIDO_BUSCA||'%' INTO :LOJA_ID, :APELIDO, :ATIVO DO SUSPEND; 
  END
  
  PROCEDURE LOJA_SET 
  (
    LOJA_ID ID_SHORT_NOTN_DOM 
    , APELIDO NOME_REDU_NOTN_DOM
    , ATIVO SELECIONADO_DOM NOT NULL
  )
   AS 
   BEGIN 
     UPDATE LOJA SET APELIDO = :APELIDO, ATIVO = :ATIVO WHERE LOJA_ID = :LOJA_ID; 
   END

   PROCEDURE BYID_GET
  (
    LOJA_ID ID_SHORT_NOTN_DOM 
  )
  RETURNS
  (
    APELIDO NOME_REDU_DOM
    , ATIVO BOOLEAN
  )
  AS  
  BEGIN  
    SELECT FIRST(1) L.APELIDO, L.ATIVO FROM LOJA L WHERE L.LOJA_ID = :LOJA_ID INTO :APELIDO, :ATIVO;  
    SUSPEND;
  END
  
  PROCEDURE GARANTIR
  (
    LOJA_ID ID_SHORT_NOTN_DOM
    , APELIDO NOME_REDU_NOTN_DOM
    , ATIVO SELECIONADO_DOM NOT NULL
  )
  AS
  BEGIN
    UPDATE OR INSERT INTO LOJA (LOJA_ID, APELIDO, ATIVO)
    VALUES (:LOJA_ID, :APELIDO, :ATIVO)
    MATCHING (LOJA_ID);
  END

END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
