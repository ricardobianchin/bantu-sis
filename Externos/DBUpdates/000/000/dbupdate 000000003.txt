LOJA

DOMAINS
-------
SELECIONADO_DOM
NOME_INTERM_DOM

TABELAS
-------
LOJA
TERMINAL

PACKAGES
-------
LOJA_INICIAL_PA

INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=LOJA
DBATUALIZ_OBJETIVO=CRIAR LOJA, TERMINAL, PACKAGE LOJA_INICIAL_PA, SELECIONADO_DOM
DBATUALIZ_OBS=

// DOMAINS
COMANDO INI
COMANDO_TIPO=CREATE DOMAINS

```FIREBIRD
CREATE DOMAIN SELECIONADO_DOM AS BOOLEAN DEFAULT FALSE;
CREATE DOMAIN ATIVO_DOM AS BOOLEAN DEFAULT TRUE;
CREATE DOMAIN NOME_INTERM_DOM AS VARCHAR(40);
CREATE DOMAIN NOME_INTERM_NOTN_DOM AS VARCHAR(40) NOT NULL;
CREATE DOMAIN ID_CHAR_DOM AS CHAR(1);
CREATE DOMAIN ID_CHAR_NOTN_DOM AS CHAR(1) NOT NULL;
```
COMANDO FIM



// TABELA LOJA
COMANDO INI
COMANDO_TIPO=CREATE TABLE
OBJETO_NOME=LOJA

COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

//NOME    TIPO    NOTNULL    PRIM    UNIQUE

LOJA_ID;ID_SHORT_DOM;S;S;N
APELIDO;NOME_REDU_DOM;S;N;S
SELECIONADO;SELECIONADO_DOM

COLUNAS FIM
COMANDO FIM



// TABELA SIS_AMBIENTE
COMANDO INI
COMANDO_TIPO=CREATE TABLE
OBJETO_NOME=SIS_AMBIENTE

COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

//NOME    TIPO    NOTNULL    PRIM    UNIQUE

SIS_AMBIENTE_ID;ID_SHORT_DOM;S;S;N
TERMINAL_ID;ID_SHORT_DOM

COLUNAS FIM
COMANDO FIM



// TABELA TERMINAL
COMANDO INI

COMANDO_TIPO=CREATE TABLE
OBJETO_NOME=TERMINAL
COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

//NOME    TIPO    NOTNULL    PRIM    UNIQUE

TERMINAL_ID;ID_SHORT_DOM;S;S
NUM_EXIB;INTEGER;S
NOME_NA_REDE;NOME_INTERM_DOM

NOME_EXIB;NOME_REDU_DOM

NF_SERIE;SMALLINT

LETRA_DO_DRIVE_DO_SISTEMA;CHAR(1) DEFAULT 'C'
CAMINHO_DE_REDE_DO_SISTEMA;PATH_DOM
GAVETA_TEM;BOOLEAN DEFAULT FALSE

BALANCA_ID;ID_SHORT_DOM DEFAULT 0
BALANCA_PORTA_NUM;SMALLINT

BARRAS_COD_INI;SMALLINT DEFAULT 2
BARRAS_COD_TAM;SMALLINT DEFAULT 6

CUPOM_NLINS_FINAL;SMALLINT DEFAULT 0

SEMPRE_OFFLINE;BOOLEAN DEFAULT FALSE

COLUNAS FIM
COMANDO FIM



//////////////////////////////////
//
// FOREIGN KEY TERMINAL BALANCA
//
//////////////////////////////////
COMANDO INI
COMANDO_TIPO=CREATE FOREIGN KEY
//OBJETO_NOME=
TABELA_FK=TERMINAL
CAMPOS_FK=BALANCA_ID
TABELA_PK=BALANCA
//CAMPOS_PK=BALANCA_ID
COMANDO FIM
//OBJETO_NOME e CAMPOS_PK nao sao obrigatorios
// FOREIGN KEY TERMINAL BALANCA FIM








// PACKAGE LOJA_INICIAL_PA
COMANDO INI
COMANDO_TIPO=CREATE OR ALTER PACKAGE
OBJETO_NOME=LOJA_INICIAL_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE LOJA_INICIAL_PA
AS
BEGIN
  PROCEDURE INS
  (
    LOJA_ID ID_SHORT_NOTN_DOM
    , APELIDO NOME_REDU_NOTN_DOM
    , SELECIONADO SELECIONADO_DOM NOT NULL
  );  

  PROCEDURE SELECIONADO_GET
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_REDU_DOM
  );

  PROCEDURE LISTA_GET
  (
    APELIDO_BUSCA NOME_REDU_DOM
  )
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_REDU_DOM
    , SELECIONADO BOOLEAN
  );

  PROCEDURE LOJA_SET
  (
    LOJA_ID ID_SHORT_NOTN_DOM
    , APELIDO NOME_REDU_NOTN_DOM
    , SELECIONADO SELECIONADO_DOM NOT NULL
  );
  PROCEDURE BYID_GET
  (
    LOJA_ID ID_SHORT_NOTN_DOM 
  )
  RETURNS
  (
    APELIDO NOME_REDU_DOM
    , SELECIONADO BOOLEAN
  );

  PROCEDURE GARANTIR
  (
    LOJA_ID ID_SHORT_NOTN_DOM
    , APELIDO NOME_REDU_NOTN_DOM
    , SELECIONADO SELECIONADO_DOM NOT NULL
  );
END^
/*
----------
BODY
----------
*/
RECREATE PACKAGE BODY LOJA_INICIAL_PA
AS
BEGIN
  PROCEDURE INS
  (
    LOJA_ID ID_SHORT_NOTN_DOM 
    , APELIDO NOME_REDU_NOTN_DOM
    , SELECIONADO SELECIONADO_DOM NOT NULL
  )
  AS
  BEGIN
    INSERT INTO LOJA(
      LOJA_ID
      , APELIDO
      , SELECIONADO
    )VALUES(
      :LOJA_ID
      , :APELIDO
      , :SELECIONADO
    );
  END
  
  PROCEDURE SELECIONADO_GET
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_REDU_DOM
  )
  AS
  BEGIN
    FOR SELECT L.LOJA_ID, L.APELIDO FROM LOJA L WHERE L.SELECIONADO = TRUE 
    INTO :LOJA_ID, :APELIDO 
    DO 
    SUSPEND;
  END
  PROCEDURE LISTA_GET
  (
    APELIDO_BUSCA NOME_REDU_DOM
  )
  RETURNS
  (
    LOJA_ID SMALLINT
    , APELIDO NOME_REDU_DOM
    , SELECIONADO BOOLEAN
  )
  AS 
  BEGIN 
    IF (TRIM(APELIDO_BUSCA) = '') THEN 
      FOR SELECT L.LOJA_ID, L.APELIDO, L.SELECIONADO FROM LOJA L INTO :LOJA_ID, :APELIDO, :SELECIONADO DO SUSPEND; 
    ELSE 
      FOR SELECT L.LOJA_ID, L.APELIDO, L.SELECIONADO FROM LOJA L WHERE L.APELIDO LIKE '%'||:APELIDO_BUSCA||'%' INTO :LOJA_ID, :APELIDO, :SELECIONADO DO SUSPEND; 
  END
  
  PROCEDURE LOJA_SET 
  (
    LOJA_ID ID_SHORT_NOTN_DOM 
    , APELIDO NOME_REDU_NOTN_DOM
    , SELECIONADO SELECIONADO_DOM NOT NULL
  )
   AS 
   BEGIN 
     UPDATE LOJA SET APELIDO = :APELIDO, SELECIONADO = :SELECIONADO WHERE LOJA_ID = :LOJA_ID; 
   END

   PROCEDURE BYID_GET
  (
    LOJA_ID ID_SHORT_NOTN_DOM 
  )
  RETURNS
  (
    APELIDO NOME_REDU_DOM
    , SELECIONADO BOOLEAN
  )
  AS  
  BEGIN  
    SELECT FIRST(1) L.APELIDO, L.SELECIONADO FROM LOJA L WHERE L.LOJA_ID = :LOJA_ID INTO :APELIDO, :SELECIONADO;  
    SUSPEND;
  END
  
  PROCEDURE GARANTIR
  (
    LOJA_ID ID_SHORT_NOTN_DOM
    , APELIDO NOME_REDU_NOTN_DOM
    , SELECIONADO SELECIONADO_DOM NOT NULL
  )
  AS
  BEGIN
    UPDATE OR INSERT INTO LOJA (LOJA_ID, APELIDO, SELECIONADO)
    VALUES (:LOJA_ID, :APELIDO, :SELECIONADO)
    MATCHING (LOJA_ID);
  END

END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
