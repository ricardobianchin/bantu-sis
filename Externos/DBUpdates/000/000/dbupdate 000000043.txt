IMPORT PROD_TIPO

//INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=CRIA IMPORTACAO PROD_TIPO
DBATUALIZ_OBJETIVO=CRIA IMPORT_PROD_TIPO E IMPORT_PROD_TIPO_PA
DBATUALIZ_OBS=






///////////////////////////////////////////
// SEQUENCE IMPORT_PROD_TIPO_SEQ
///////////////////////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE SEQUENCE
OBJETO_NOME=IMPORT_PROD_TIPO_SEQ
//VALOR_INICIAL=3
COMANDO FIM
// SEQUENCE IMPORT_PROD_TIPO_SEQ FIM






///////////////////////////////////////////
// TABELA IMPORT_PROD_TIPO
///////////////////////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=IMPORT_PROD_TIPO

COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

//NOME    TIPO    NOTNULL    PRIM    UNIQUE
IMPORT_PROD_TIPO_ID;ID_DOM;S;S
PROD_TIPO_ID;ID_SHORT_DOM
DESCR;NOME_REDU_DOM

COLUNAS FIM
COMANDO FIM
//TABELA IMPORT_PROD_TIPO FIM






// PACKAGE 
COMANDO INI
TIPO_COMANDO=CREATE OR ALTER PACKAGE
OBJETO_NOME=IMPORT_PROD_TIPO_PA

/*
Complementos\Est\prod_pa.txt

C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\import_PROD_TIPO_pa.sql
in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\import_PROD_TIPO_pa.sql";
*/

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE IMPORT_PROD_TIPO_PA
AS
BEGIN
  PROCEDURE GARANTIR_ID_DESCR
  (
    DESCR NOME_REDU_DOM NOT NULL, 
    PROD_TIPO_ID ID_SHORT_DOM
  )
  RETURNS
  (
    IMPORT_PROD_TIPO_ID ID_DOM
  );
  
  PROCEDURE APAGAR_DO;
END^

----- body -----

RECREATE PACKAGE BODY IMPORT_PROD_TIPO_PA
AS
BEGIN
  PROCEDURE GARANTIR_ID_DESCR
  (
    DESCR NOME_REDU_DOM NOT NULL,
    PROD_TIPO_ID ID_SHORT_DOM
  )
  RETURNS 
  (
    IMPORT_PROD_TIPO_ID ID_DOM
  )
  AS
  BEGIN
    SELECT IMPORT_PROD_TIPO_ID FROM IMPORT_PROD_TIPO WHERE DESCR = :DESCR INTO :IMPORT_PROD_TIPO_ID;
    
    IF (IMPORT_PROD_TIPO_ID IS NOT NULL) THEN
    BEGIN
      UPDATE IMPORT_PROD_TIPO SET PROD_TIPO_ID = :PROD_TIPO_ID WHERE IMPORT_PROD_TIPO_ID = :IMPORT_PROD_TIPO_ID;
    END
    ELSE
    BEGIN
      IMPORT_PROD_TIPO_ID = NEXT VALUE FOR IMPORT_PROD_TIPO_SEQ;
      INSERT INTO IMPORT_PROD_TIPO (IMPORT_PROD_TIPO_ID, DESCR, PROD_TIPO_ID) VALUES (:IMPORT_PROD_TIPO_ID, :DESCR, :PROD_TIPO_ID);
    END
    SUSPEND;
  END
  
  PROCEDURE APAGAR_DO
  AS
  BEGIN
    EXECUTE STATEMENT('ALTER SEQUENCE IMPORT_PROD_TIPO_SEQ RESTART WITH 1;');
    DELETE FROM IMPORT_PROD_TIPO;
  END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
