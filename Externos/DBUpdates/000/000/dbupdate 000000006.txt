=SECONFIG_SIS

INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=SIS
DBATUALIZ_OBJETIVO=CRIAR CONFIG_SIS E CONFIG_SIS_PA
DBATUALIZ_OBS=


/////////////////////////
//
// CREATE DOMAINS
//
/////////////////////////
COMANDO INI
COMANDO_TIPO=CREATE DOMAINS
```FIREBIRD
CREATE DOMAIN CONFIG_CHAVE_DOM AS VARCHAR(89);
CREATE DOMAIN CONFIG_VALOR_DOM AS VARCHAR(144);
```
COMANDO FIM




/////////////////////////
//
// TABELA CONFIG_SIS
//
/////////////////////////
COMANDO INI
COMANDO_TIPO=CREATE TABLE
OBJETO_NOME=CONFIG_SIS
COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM

CHAVE;CONFIG_CHAVE_DOM;S,S
VALOR;CONFIG_VALOR_DOM

COLUNAS FIM
COMANDO FIM





/////////////////////////
//
// TABELA CONFIG_SIS_PA
//
/////////////////////////
COMANDO INI
COMANDO_TIPO=CREATE OR ALTER PACKAGE
OBJETO_NOME=CONFIG_SIS_PA
/*
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Sis\
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Sis\CONFIG_SIS_PA.sql

"C:\Program Files\Notepad++\notepad++.exe" "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Sis\CONFIG_SIS_PA.sql"

in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Sis\CONFIG_SIS_PA.sql";
*/
```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE CONFIG_SIS_PA
AS
BEGIN
  PROCEDURE GARANTIR
  (
    CHAVE CONFIG_CHAVE_DOM NOT NULL, 
    VALOR CONFIG_VALOR_DOM
  );

  FUNCTION VALOR_GET
  (
    CHAVE CONFIG_CHAVE_DOM,
    VALOR_DEFAULT CONFIG_VALOR_DOM DEFAULT NULL
  ) RETURNS CONFIG_VALOR_DOM;
END^

RECREATE PACKAGE BODY CONFIG_SIS_PA
AS
BEGIN
  -- CONFIG_SIS_PA.GARANTIR DEF
  PROCEDURE GARANTIR
  (
    CHAVE CONFIG_CHAVE_DOM NOT NULL, 
    VALOR CONFIG_VALOR_DOM
  )
  AS
  BEGIN
    -- CONFIG_SIS_PA.GARANTIR COD
    //:CHAVE = UPPER(:CHAVE);

    IF (UPPER(:VALOR) = 'NULL') OR (:VALOR = '') THEN
    BEGIN
      DELETE FROM CONFIG_SIS
      WHERE CHAVE = :CHAVE;
    END
    ELSE
    BEGIN
      UPDATE OR INSERT INTO CONFIG_SIS (CHAVE, VALOR)
      VALUES (:CHAVE, :VALOR)
      MATCHING (CHAVE);
    END
  END
  
  FUNCTION VALOR_GET
  (
    CHAVE CONFIG_CHAVE_DOM,
    VALOR_DEFAULT CONFIG_VALOR_DOM-- DEFAULT NULL
  ) RETURNS CONFIG_VALOR_DOM 
  AS
    DECLARE VARIABLE VALOR_RET CONFIG_VALOR_DOM;
  BEGIN
    SELECT VALOR 
    FROM CONFIG_SIS 
    WHERE CHAVE = :CHAVE 
    INTO :VALOR_RET;

    IF (VALOR_RET IS NULL) THEN
    BEGIN
      IF (VALOR_DEFAULT IS NOT NULL) THEN
      BEGIN
        EXECUTE PROCEDURE GARANTIR(:CHAVE, :VALOR_DEFAULT);
        VALOR_RET = :VALOR_DEFAULT;
      END
    END

    RETURN VALOR_RET;
  END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
