IMPORT FABR

//INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=CRIA IMPORTACAO FABR
DBATUALIZ_OBJETIVO=CRIA IMPORT_FABR E IMPORT_FABR_PA
DBATUALIZ_OBS=






///////////////////////////////////////////
// SEQUENCE IMPORT_FABR_SEQ
///////////////////////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE SEQUENCE
OBJETO_NOME=IMPORT_FABR_SEQ
//VALOR_INICIAL=3
COMANDO FIM
// SEQUENCE IMPORT_FABR_SEQ FIM






///////////////////////////////////////////
// TABELA IMPORT_FABR
///////////////////////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=IMPORT_FABR

COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

//NOME    TIPO    NOTNULL    PRIM    UNIQUE
IMPORT_FABR_ID;ID_DOM;S;S
FABR_ID;ID_SHORT_DOM
NOME;NOME_REDU_DOM

COLUNAS FIM
COMANDO FIM
//TABELA IMPORT_FABR FIM






// PACKAGE 
COMANDO INI
TIPO_COMANDO=CREATE OR ALTER PACKAGE
OBJETO_NOME=IMPORT_FABR_PA

/*
Complementos\Est\prod_pa.txt

C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\import_fabr_pa.sql
in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\import_fabr_pa.sql";
*/

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE IMPORT_FABR_PA
AS
BEGIN
  PROCEDURE GARANTIR_ID_DESCR
  (
    NOME NOME_REDU_DOM NOT NULL, 
    FABR_ID ID_SHORT_DOM
  )
  RETURNS
  (
    IMPORT_FABR_ID ID_DOM
  );
  
  PROCEDURE APAGAR_DO;
END^

----- body -----

RECREATE PACKAGE BODY IMPORT_FABR_PA
AS
BEGIN
  PROCEDURE GARANTIR_ID_DESCR
  (
    NOME NOME_REDU_DOM NOT NULL,
    FABR_ID ID_SHORT_DOM
  )
  RETURNS 
  (
    IMPORT_FABR_ID ID_DOM
  )
  AS
  BEGIN
    SELECT IMPORT_FABR_ID FROM IMPORT_FABR WHERE NOME = :NOME INTO :IMPORT_FABR_ID;
    
    IF (IMPORT_FABR_ID IS NOT NULL) THEN
    BEGIN
      UPDATE IMPORT_FABR SET FABR_ID = :FABR_ID WHERE IMPORT_FABR_ID = :IMPORT_FABR_ID;
    END
    ELSE
    BEGIN
      IMPORT_FABR_ID = NEXT VALUE FOR IMPORT_FABR_SEQ;
      INSERT INTO IMPORT_FABR (IMPORT_FABR_ID, NOME, FABR_ID) VALUES (:IMPORT_FABR_ID, :NOME, :FABR_ID);
    END
    SUSPEND;
  END
  
  PROCEDURE APAGAR_DO
  AS
  BEGIN
    EXECUTE STATEMENT('ALTER SEQUENCE IMPORT_FABR_SEQ RESTART WITH 1;');
    DELETE FROM IMPORT_FABR;
  END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
