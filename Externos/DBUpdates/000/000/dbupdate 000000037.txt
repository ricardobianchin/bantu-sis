CRIA
TERMINAL_PA


INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=AMBIENTE, TERMINAL_PA
DBATUALIZ_OBJETIVO=CRIAR PACKAGE TERMINAL_PA
DBATUALIZ_OBS=



-- PACKAGE TERMINAL_PA
/*
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\Ambiente\
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\Ambiente\terminal_pa.sql

"C:\Program Files\Notepad++\notepad++.exe" "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\Ambiente\terminal_pa.sql"

in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\Ambiente\terminal_pa.sql";
*/

COMANDO INI
COMANDO_TIPO=CREATE OR ALTER PACKAGE
OBJETO_NOME=TERMINAL_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE TERMINAL_PA
AS
BEGIN
  -- TERMINAL_PA.GARANTIR DEF
  PROCEDURE GARANTIR (
    TERMINAL_ID ID_SHORT_DOM,
    APELIDO NOME_REDU_DOM,
    NOME_NA_REDE VARCHAR(15),
    IP IPV6_DOM,
    NF_SERIE SMALLINT,
    LETRA_DO_DRIVE CHAR(1),
    GAVETA_TEM BOOLEAN,
    BALANCA_MODO_ID ID_SHORT_DOM,
    BALANCA_ID ID_SHORT_DOM,
    BARRAS_COD_INI SMALLINT,
    BARRAS_COD_TAM SMALLINT,
    CUPOM_NLINS_FINAL SMALLINT,
    SEMPRE_OFFLINE BOOLEAN,
    LOG_LOJA_ID ID_SHORT_DOM,
    LOG_PESSOA_ID ID_DOM,
    MACHINE_ID ID_SHORT_DOM
  );
END^
/*
----------
BODY
----------
*/
RECREATE PACKAGE BODY TERMINAL_PA
AS
BEGIN
  -- TERMINAL_PA.GARANTIR IMP
  PROCEDURE GARANTIR
  (
    TERMINAL_ID ID_SHORT_DOM,
    APELIDO NOME_REDU_DOM,
    NOME_NA_REDE VARCHAR(15),
    IP IPV6_DOM,
    NF_SERIE SMALLINT,
    LETRA_DO_DRIVE CHAR(1),
    GAVETA_TEM BOOLEAN,
    BALANCA_MODO_ID ID_SHORT_DOM,
    BALANCA_ID ID_SHORT_DOM,
    BARRAS_COD_INI SMALLINT,
    BARRAS_COD_TAM SMALLINT,
    CUPOM_NLINS_FINAL SMALLINT,
    SEMPRE_OFFLINE BOOLEAN,
    LOG_LOJA_ID ID_SHORT_DOM,
    LOG_PESSOA_ID ID_DOM,
    MACHINE_ID ID_SHORT_DOM
  )
  AS
    -- TERMINAL VARS LOG VAR LOG VARLOG VARSLOG
    DECLARE FEATURE_SIS_ID ID_SHORT_DOM = 2; -- TERMINAIS
    DECLARE RETAGUARDA_TERMINAL_ID ID_SHORT_DOM = 0;
    DECLARE CONFIG_MODULO_SIS_ID ID_CHAR_DOM = '!';
    DECLARE ACAO_SIS_ID ID_CHAR_DOM = '''';--GARANTIR
    DECLARE LOG_ID_RET BIGINT;
  BEGIN
    -- TERMINAL_PA.GARANTIR COD
    UPDATE OR INSERT INTO TERMINAL (
      TERMINAL_ID, APELIDO, NOME_NA_REDE, IP, NF_SERIE, LETRA_DO_DRIVE, 
      GAVETA_TEM, BALANCA_MODO_ID, BALANCA_ID, BARRAS_COD_INI, BARRAS_COD_TAM, 
      CUPOM_NLINS_FINAL, SEMPRE_OFFLINE
    ) VALUES (
      :TERMINAL_ID, :APELIDO, :NOME_NA_REDE, :IP, :NF_SERIE, :LETRA_DO_DRIVE, 
      :GAVETA_TEM, :BALANCA_MODO_ID, :BALANCA_ID, :BARRAS_COD_INI, :BARRAS_COD_TAM, 
      :CUPOM_NLINS_FINAL, :SEMPRE_OFFLINE
    ) MATCHING (TERMINAL_ID);

    SELECT LOG_ID_RET
    FROM LOG_PA.LOG_NOVO_GET
    (
      :LOG_LOJA_ID,
      :RETAGUARDA_TERMINAL_ID,
      :LOG_PESSOA_ID,
      :CONFIG_MODULO_SIS_ID,
      :ACAO_SIS_ID,
      :FEATURE_SIS_ID,
      :MACHINE_ID
    ) INTO :LOG_ID_RET;

    EXECUTE PROCEDURE LOG_PA.LOG_ENVOLVE_ID_INS
    (
      :LOG_LOJA_ID,
      :RETAGUARDA_TERMINAL_ID,
      :LOG_ID_RET,
      0,

      NULL, --LOJA_ID_ENVOLVIDO SMALLINT,
      TERMINAL_ID, --TERMINAL_ID_ENVOLVIDO SMALLINT,
      NULL, --ID_ENVOLVIDO INTEGER,
      NULL --ORDEM_ENVOLVIDO SMALLINT
    );
    END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
