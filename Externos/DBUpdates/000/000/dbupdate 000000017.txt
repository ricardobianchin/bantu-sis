PROD_TIPO

//INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=PROD_TIPO
DBATUALIZ_OBJETIVO=CRIA PROD_TIPO
DBATUALIZ_OBS=


/////////////////////////
// SEQUENCE PROD_TIPO_SEQ
/////////////////////////
COMANDO INI
TIPO_COMANDO=CREATE SEQUENCE
OBJETO_NOME=PROD_TIPO_SEQ
VALOR_INICIAL=2
COMANDO FIM
// SEQUENCE PROD_TIPO_SEQ FIM


/////////////////////////
//
// TABELA PROD_TIPO
//
/////////////////////////
COMANDO INI

TIPO_COMANDO=CREATE TABLE
OBJETO_NOME=PROD_TIPO
COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

PROD_TIPO_ID;ID_SHORT_DOM;S;S
DESCR;NOME_INTERM_DOM;S;N;S
COLUNAS FIM
COMANDO FIM


// PACKAGE PROD_TIPO_PA
COMANDO INI
TIPO_COMANDO=CREATE OR ALTER PACKAGE
OBJETO_NOME=PROD_TIPO_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE PROD_TIPO_PA
AS
BEGIN
  PROCEDURE LISTA_SELECT_GET
  RETURNS
  (
    REGTIPO SMALLINT
    , ID_RET SMALLINT
    , DESCR_RET VARCHAR(40)
  );

  PROCEDURE LISTA_GET
  (
    DESCR_BUSCA NOME_REDU_NOTN_DOM
  )
  RETURNS
  (
    PROD_TIPO_ID SMALLINT
    , DESCR NOME_INTERM_DOM
  );
  PROCEDURE BYID_GET
  (
    PROD_TIPO_ID ID_SHORT_NOTN_DOM 
  )
  RETURNS
  (
    DESCR NOME_INTERM_DOM
  );
  PROCEDURE GARANTIR
  (
    PROD_TIPO_ID ID_SHORT_NOTN_DOM
    , DESCR NOME_INTERM_NOTN_DOM
  )  
  RETURNS
  (
    ID_GRAVADO SMALLINT
  );

  PROCEDURE BYDESCR_GET
  (
    DESCR NOME_INTERM_DOM
  )
  RETURNS
  (
    PROD_TIPO_ID SMALLINT
  );    
  
END^

RECREATE PACKAGE BODY PROD_TIPO_PA
AS
BEGIN
  PROCEDURE LISTA_SELECT_GET
  RETURNS
  (
    REGTIPO SMALLINT
    , ID_RET SMALLINT
    , DESCR_RET VARCHAR(40)
  )
  AS
  BEGIN
    FOR SELECT 2 AS REGTIPO, PROD_TIPO_ID, DESCR FROM LISTA_GET('')
    INTO :REGTIPO, :ID_RET, :DESCR_RET
    DO
      SUSPEND;
  END

  PROCEDURE LISTA_GET
  (
    DESCR_BUSCA NOME_REDU_NOTN_DOM
  )
  RETURNS
  (
    PROD_TIPO_ID SMALLINT
    , DESCR NOME_INTERM_DOM
  )
  AS 
  BEGIN 
    IF (TRIM(DESCR_BUSCA) = '') THEN 
      FOR SELECT PT.PROD_TIPO_ID, PT.DESCR FROM PROD_TIPO PT INTO :PROD_TIPO_ID, :DESCR DO SUSPEND; 
    ELSE 
      FOR SELECT PT.PROD_TIPO_ID, PT.DESCR FROM PROD_TIPO PT WHERE PT.DESCR LIKE '%'||:DESCR_BUSCA||'%' INTO :PROD_TIPO_ID, :DESCR DO SUSPEND; 
  END

   PROCEDURE BYID_GET
  (
    PROD_TIPO_ID ID_SHORT_NOTN_DOM 
  )
  RETURNS
  (
    DESCR NOME_INTERM_DOM
  )
  AS  
  BEGIN  
    SELECT FIRST(1) PT.DESCR FROM PROD_TIPO PT WHERE PT.PROD_TIPO_ID = :PROD_TIPO_ID INTO :DESCR;  
    SUSPEND;
  END
  
  PROCEDURE GARANTIR
  (
    PROD_TIPO_ID ID_SHORT_NOTN_DOM
    , DESCR NOME_INTERM_NOTN_DOM
)
  RETURNS
  (
    ID_GRAVADO SMALLINT
  )
  AS
  BEGIN
    IF (PROD_TIPO_ID < 1) THEN
    BEGIN
      ID_GRAVADO = NEXT VALUE FOR PROD_TIPO_SEQ;
  	END
    ELSE
    BEGIN
	    ID_GRAVADO = PROD_TIPO_ID;
    END	
	
    UPDATE OR INSERT INTO PROD_TIPO (PROD_TIPO_ID, DESCR)
    VALUES (:ID_GRAVADO, :DESCR)
    MATCHING (PROD_TIPO_ID);
    SUSPEND;
  END

  PROCEDURE BYDESCR_GET
  (
    DESCR NOME_INTERM_DOM
  )
  RETURNS
  (
    PROD_TIPO_ID SMALLINT
  )
  AS
  BEGIN
    SELECT FIRST(1) PROD_TIPO_ID FROM PROD_TIPO WHERE DESCR = :DESCR INTO :PROD_TIPO_ID;
    SUSPEND;
  END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
