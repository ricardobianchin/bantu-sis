SYNC_DO_TERMINAL_SIS

-----------------------------
TESTES INICIO
-----------------------------
SELECT * FROM SYNC_DO_TERMINAL_SIS_PA.ULTIMO_GET(2);
SELECT * FROM SYNC_DO_TERMINAL_SIS;
EXECUTE PROCEDURE SYNC_DO_TERMINAL_SIS_PA.ATUALIZE(2, 10);
SELECT * FROM SYNC_DO_TERMINAL_SIS_PA.ULTIMO_GET(2);
ROLLBACK;


-----------------------------
TESTES FIM 
-----------------------------


/*
Externos\DBUpdates Complementos\Complementos\Assist\SYNC_DO_TERMINAL_SIS_PA.sql
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Assist\
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Assist\SYNC_DO_TERMINAL_SIS_PA.sql

"C:\Program Files\Notepad++\notepad++.exe" "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Assist\SYNC_DO_TERMINAL_SIS_PA.sql"

in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Assist\SYNC_DO_TERMINAL_SIS_PA.sql";
*/

-----------------------------
INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_PONTO_ALVO=SERVIDOR
DBATUALIZ_ASSUNTO=SIS
DBATUALIZ_OBJETIVO=CRIA SYNC_DO_TERMINAL_SIS
DBATUALIZ_OBS=


//TABELA SYNC_DO_TERMINAL_SIS

COMANDO INI
COMANDO_TIPO=CREATE TABLE
OBJETO_NOME=SYNC_DO_TERMINAL_SIS

COLUNAS INI
//NOME;TIPO;NOT NULL;PRIM;UNIQUE

TERMINAL_ID SMALLINT;S;S
LOG_ID_ULTIMO_TRAZIDO;BIGINT;S

COLUNAS FIM
COMANDO FIM
//TABELA SYNC_DO_TERMINAL FIM



// PACKAGE SYNC_DO_TERMINAL_SIS_PA
COMANDO INI
COMANDO_TIPO=CREATE OR ALTER PACKAGE
OBJETO_NOME=SYNC_DO_TERMINAL_SIS_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE SYNC_DO_TERMINAL_SIS_PA
AS
BEGIN
  PROCEDURE ULTIMO_GET(TERMINAL_ID SMALLINT NOT NULL)
  RETURNS (LOG_ID_ULTIMO_TRAZIDO_RET BIGINT);
  
  PROCEDURE ATUALIZE(TERMINAL_ID SMALLINT NOT NULL, LOG_ID_ULTIMO_TRAZIDO BIGINT NOT NULL);
END^
/*
----------
BODY
----------
*/
RECREATE PACKAGE BODY SYNC_DO_TERMINAL_SIS_PA
AS
BEGIN
  PROCEDURE ULTIMO_GET(TERMINAL_ID SMALLINT NOT NULL)
    RETURNS (LOG_ID_ULTIMO_TRAZIDO_RET BIGINT)
  AS
  BEGIN
    SELECT LOG_ID_ULTIMO_TRAZIDO
    FROM SYNC_DO_TERMINAL_SIS
    WHERE TERMINAL_ID = :TERMINAL_ID
    INTO :LOG_ID_ULTIMO_TRAZIDO_RET;
    
    IF (LOG_ID_ULTIMO_TRAZIDO_RET IS NULL) THEN
    BEGIN
      INSERT INTO SYNC_DO_TERMINAL_SIS (TERMINAL_ID, LOG_ID_ULTIMO_TRAZIDO)
      VALUES (:TERMINAL_ID, 0);
      LOG_ID_ULTIMO_TRAZIDO_RET = 0;
    END
    SUSPEND;
  END

  PROCEDURE ATUALIZE(TERMINAL_ID SMALLINT NOT NULL, LOG_ID_ULTIMO_TRAZIDO BIGINT NOT NULL)
  AS
  BEGIN
    UPDATE SYNC_DO_TERMINAL_SIS
    SET LOG_ID_ULTIMO_TRAZIDO = :LOG_ID_ULTIMO_TRAZIDO
    WHERE TERMINAL_ID = :TERMINAL_ID;
  END
END^
SET TERM ;^
```
COMANDO FIM


DBATUALIZ FIM
