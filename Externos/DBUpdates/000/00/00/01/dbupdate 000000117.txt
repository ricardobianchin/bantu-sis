FORNEC_PROD_ID_PA


"C:\Program Files\Notepad++\notepad++.exe" "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates\000\00\00\00\dbupdate 000000109.txt"

SELECT DBUPDATE_PA.VERSAO_GET() FROM RDB$DATABASE;

show package FORNEC_PROD_ID_PA;

DROP PACKAGE FORNEC_PROD_ID_PA;
DELETE FROM DBUPDATE_HIST WHERE NUM>=115;
COMMIT;



/*
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Estoque
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Estoque\ENTRADA_PA.sql

"C:\Program Files\Notepad++\notepad++.exe" "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Estoque\ENTRADA_PA.sql"

in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Estoque\ENTRADA_PA.sql";
*/


-----------------------------
INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=ESTOQUE
DBATUALIZ_OBJETIVO=CRIAR FORNEC_PROD_ID_PA
DBATUALIZ_PONTO_ALVO=SERVIDOR
DBATUALIZ_OBS=




/////////////////////////
//
// PACKAGE FORNEC_PROD_ID_PA
//
/////////////////////////
COMANDO INI
COMANDO_TIPO=CREATE OR ALTER PACKAGE
OBJETO_NOME=FORNEC_PROD_ID_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE FORNEC_PROD_ID_PA
AS
BEGIN
  PROCEDURE FORNEC_PROD_ID_PREENCHA 
  (
    LOJA_ID ID_SHORT_DOM,
    TERMINAL_ID ID_SHORT_DOM,
    EST_MOV_ID BIGINT
  );
END^

----- BODY

RECREATE PACKAGE BODY FORNEC_PROD_ID_PA
AS
BEGIN
  PROCEDURE FORNEC_PROD_ID_PREENCHA 
  (
    LOJA_ID ID_SHORT_DOM,
    TERMINAL_ID ID_SHORT_DOM,
    EST_MOV_ID BIGINT
  )
  AS
  BEGIN
    FOR SELECT 
        E.LOJA_ID,
        E.TERMINAL_ID,
        E.FORNECEDOR_ID,
        EI.PROD_ID_DELES,
        EMI.PROD_ID
    FROM ENTRADA E
    JOIN EST_MOV_ITEM EMI ON
        E.LOJA_ID = EMI.LOJA_ID
        AND E.TERMINAL_ID = EMI.TERMINAL_ID
        AND E.EST_MOV_ID = EMI.EST_MOV_ID
    JOIN ENTRADA_ITEM EI ON
        EMI.LOJA_ID = EI.LOJA_ID
        AND EMI.TERMINAL_ID = EI.TERMINAL_ID
        AND EMI.EST_MOV_ID = EI.EST_MOV_ID
        AND EMI.ORDEM = EI.ORDEM
    WHERE E.LOJA_ID = :LOJA_ID
        AND E.TERMINAL_ID = :TERMINAL_ID
        AND E.EST_MOV_ID = :EST_MOV_ID
        AND NOT EMI.CANCELADO
    ORDER BY EMI.ORDEM
    INTO :LOJA_ID, :TERMINAL_ID, :FORNECEDOR_ID, :PROD_ID_DELES, :PROD_ID
    DO
    BEGIN
      UPDATE OR INSERT INTO FORNEC_PROD_ID 
      (
        LOJA_ID,
        TERMINAL_ID,
        FORNECEDOR_ID,
        PROD_ID_DELES,
        PROD_ID
      )
      VALUES 
      (
        :LOJA_ID,
        :TERMINAL_ID,
        :FORNECEDOR_ID,
        :PROD_ID_DELES,
         :PROD_ID
      )
      MATCHING (LOJA_ID, TERMINAL_ID, FORNECEDOR_ID, PROD_ID_DELES);
    END
  END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
