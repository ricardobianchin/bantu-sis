CRIA
TERMINAL_PA


INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=AMBIENTE, TERMINAL_PA
DBATUALIZ_OBJETIVO=CRIAR PACKAGE TERMINAL_PA
DBATUALIZ_OBS=



-- PACKAGE TERMINAL_PA
/*
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\Ambiente\
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\Ambiente\terminal_pa.sql

"C:\Program Files\Notepad++\notepad++.exe" "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\Ambiente\terminal_pa.sql"

in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Config\Ambiente\terminal_pa.sql";
*/

COMANDO INI
COMANDO_TIPO=CREATE OR ALTER PACKAGE
OBJETO_NOME=TERMINAL_PA

```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE TERMINAL_PA
AS
BEGIN
  -- TERMINAL_PA.GARANTIR DEF
  PROCEDURE GARANTIR 
  (
    TERMINAL_ID ID_SHORT_DOM,

    APELIDO NOME_REDU_DOM,
    NOME_NA_REDE VARCHAR(15),
    IP IPV6_DOM,
    LETRA_DO_DRIVE CHAR(1),

    NF_SERIE SMALLINT,

    GAVETA_TEM BOOLEAN,
    GAVETA_COMANDO VARCHAR(240),
    GAVETA_IMPR_NOME VARCHAR(260),

    BALANCA_MODO_USO_ID ID_SHORT_DOM,
    BALANCA_ID ID_SHORT_DOM,

    BARRAS_COD_INI SMALLINT,
    BARRAS_COD_TAM SMALLINT,

    IMPRESSORA_MODO_ENVIO_ID ID_SHORT_DOM,
    IMPRESSORA_MODELO_ID ID_SHORT_DOM,
    IMPRESSORA_NOME VARCHAR(260),
    IMPRESSORA_COLS_QTD SMALLINT,
    
    CUPOM_QTD_LINS_FINAL SMALLINT,

    SEMPRE_OFFLINE BOOLEAN,
    ATIVO BOOLEAN,

    LOG_LOJA_ID ID_SHORT_DOM,
    LOG_PESSOA_ID ID_DOM,
    MACHINE_ID ID_SHORT_DOM
  );
END^

---- BODY

RECREATE PACKAGE BODY TERMINAL_PA
AS
BEGIN
  -- TERMINAL_PA.GARANTIR IMP
  PROCEDURE GARANTIR
  (
    TERMINAL_ID ID_SHORT_DOM,

    APELIDO NOME_REDU_DOM,
    NOME_NA_REDE VARCHAR(15),
    IP IPV6_DOM,
    LETRA_DO_DRIVE CHAR(1),

    NF_SERIE SMALLINT,

    GAVETA_TEM BOOLEAN,
    GAVETA_COMANDO VARCHAR(240),
    GAVETA_IMPR_NOME VARCHAR(260),

    BALANCA_MODO_USO_ID ID_SHORT_DOM,
    BALANCA_ID ID_SHORT_DOM,

    BARRAS_COD_INI SMALLINT,
    BARRAS_COD_TAM SMALLINT,

    IMPRESSORA_MODO_ENVIO_ID ID_SHORT_DOM,
    IMPRESSORA_MODELO_ID ID_SHORT_DOM,
    IMPRESSORA_NOME VARCHAR(260),
    IMPRESSORA_COLS_QTD SMALLINT,
    CUPOM_QTD_LINS_FINAL SMALLINT,

    SEMPRE_OFFLINE BOOLEAN,
    ATIVO BOOLEAN,

    LOG_LOJA_ID ID_SHORT_DOM,
    LOG_PESSOA_ID ID_DOM,
    MACHINE_ID ID_SHORT_DOM
  )
  AS
    -- TERMINAL VARS LOG VAR LOG VARLOG VARSLOG
    DECLARE FEATURE_SIS_ID ID_SHORT_DOM = 2; -- TERMINAIS
    DECLARE RETAGUARDA_TERMINAL_ID ID_SHORT_DOM = 0;
    DECLARE CONFIG_MODULO_SIS_ID ID_CHAR_DOM = '!';
    DECLARE ACAO_SIS_ID ID_CHAR_DOM = '''';--GARANTIR
    DECLARE LOG_ID_RET BIGINT;
  BEGIN
    -- TERMINAL_PA.GARANTIR COD
    UPDATE OR INSERT INTO TERMINAL (
      TERMINAL_ID,
      APELIDO,
      NOME_NA_REDE,
      IP,
      LETRA_DO_DRIVE,
      NF_SERIE,
      GAVETA_TEM,
      GAVETA_COMANDO,
      GAVETA_IMPR_NOME,
      BALANCA_MODO_USO_ID,
      BALANCA_ID,
      BARRAS_COD_INI,
      BARRAS_COD_TAM,
      IMPRESSORA_MODO_ENVIO_ID,
      IMPRESSORA_MODELO_ID,
      IMPRESSORA_NOME,
      IMPRESSORA_COLS_QTD,
      CUPOM_QTD_LINS_FINAL,
      SEMPRE_OFFLINE,
      ATIVO
    ) VALUES (
      :TERMINAL_ID,
      :APELIDO,
      :NOME_NA_REDE,
      :IP,
      :LETRA_DO_DRIVE,
      :NF_SERIE,
      :GAVETA_TEM,
      :GAVETA_COMANDO,
      :GAVETA_IMPR_NOME,
      :BALANCA_MODO_USO_ID,
      :BALANCA_ID,
      :BARRAS_COD_INI,
      :BARRAS_COD_TAM,
      :IMPRESSORA_MODO_ENVIO_ID,
      :IMPRESSORA_MODELO_ID,
      :IMPRESSORA_NOME,
      :IMPRESSORA_COLS_QTD,
      :CUPOM_QTD_LINS_FINAL,
      :SEMPRE_OFFLINE,
      :ATIVO
    ) MATCHING (TERMINAL_ID);

    SELECT LOG_ID_RET
    FROM LOG_PA.LOG_NOVO_GET
    (
      :LOG_LOJA_ID,
      :RETAGUARDA_TERMINAL_ID,
      :LOG_PESSOA_ID,
      :CONFIG_MODULO_SIS_ID,
      :ACAO_SIS_ID,
      :FEATURE_SIS_ID,
      :MACHINE_ID
    ) INTO :LOG_ID_RET;

    EXECUTE PROCEDURE LOG_PA.LOG_ENVOLVE_ID_INS
    (
      :LOG_LOJA_ID,
      :RETAGUARDA_TERMINAL_ID,
      :LOG_ID_RET,
      0,

      NULL, --LOJA_ID_ENVOLVIDO SMALLINT,
      TERMINAL_ID, --TERMINAL_ID_ENVOLVIDO SMALLINT,
      NULL, --ID_ENVOLVIDO INTEGER,
      0 --ORDEM_ENVOLVIDO SMALLINT
    );
  END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
