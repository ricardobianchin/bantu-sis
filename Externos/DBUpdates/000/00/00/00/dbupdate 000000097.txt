VENDA_INICIAL_PA

DELETE FROM DBUPDATE_HIST WHERE NUM>=97;
COMMIT;


SELECT * FROM VENDA;

  

SELECT * FROM VENDA_ITEM;



ROLLBACK;


-----------------------------
INICIO
-----------------------------
DBATUALIZ INI
DBATUALIZ_ASSUNTO=ESTOQUE
DBATUALIZ_OBJETIVO=CRIAR VENDA_INICIAL_PA
DBATUALIZ_PONTO_ALVO=SERVIDOR
DBATUALIZ_OBS=




/////////////////////////
//
// PACKAGE VENDA_INICIAL_PA
//
/////////////////////////
COMANDO INI
COMANDO_TIPO=CREATE OR ALTER PACKAGE
OBJETO_NOME=VENDA_INICIAL_PA
/*

C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Estoque
C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Estoque\VENDA_INICIAL_PA.sql

"C:\Program Files\Notepad++\notepad++.exe" "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Estoque\VENDA_INICIAL_PA.sql"

in "C:\Pr\app\bantu\bantu-sis\Src\Externos\DBUpdates Complementos\Complementos\Estoque\VENDA_INICIAL_PA.sql";


*/
```FIREBIRD
SET TERM ^;
CREATE OR ALTER PACKAGE VENDA_INICIAL_PA
AS
BEGIN
  PROCEDURE VENDA_GAR
  (
    LOJA_ID ID_SHORT_DOM NOT NULL
    , TERMINAL_ID ID_SHORT_DOM NOT NULL
    , EST_MOV_ID BIGINT NOT NULL

    , VENDA_ID ID_DOM NOT NULL

    , SESS_LOJA_ID ID_SHORT_DOM NOT NULL
    , SESS_TERMINAL_ID ID_SHORT_DOM NOT NULL
    , SESS_ID ID_DOM NOT NULL

    , C VARCHAR(15) NOT NULL

    , CLIENTE_LOJA_ID ID_SHORT_DOM NOT NULL
    , CLIENTE_TERMINAL_ID ID_SHORT_DOM NOT NULL
    , CLIENTE_ID ID_DOM NOT NULL

    , ENDERECO_LOJA_ID ID_SHORT_DOM NOT NULL
    , ENDERECO_TERMINAL_ID ID_SHORT_DOM NOT NULL
    , ENDERECO_ID ID_DOM NOT NULL

    , DESCONTO_TOTAL NUMERIC(12, 2) NOT NULL
    , CUSTO_TOTAL NUMERIC(12, 2) NOT NULL
    , TOTAL_LIQUIDO NUMERIC(12, 2) NOT NULL

    , ENTREGA_TEM BOOLEAN NOT NULL
    , ENTREGADOR_PESSOA_ID ID_DOM NOT NULL
    , ENTREGA_DTH TIMESTAMP NOT NULL

    , ALTERADO_EM TIMESTAMP NOT NULL
  );
  
  
  PROCEDURE VENDA_ITEM_GAR
  (
    LOJA_ID ID_SHORT_DOM NOT NULL
    , TERMINAL_ID ID_SHORT_DOM NOT NULL
    , EST_MOV_ID BIGINT NOT NULL
    , EST_MOV_ITEM_ORDEM SMALLINT NOT NULL

    , CUSTO_UNIT NUMERIC(12, 4) NOT NULL
    , CUSTO NUMERIC(12, 2) NOT NULL

    , PRECO_UNIT_ORIGINAL NUMERIC(12, 2) NOT NULL
    , PRECO_UNIT_PROMO NUMERIC(12, 2) NOT NULL
    , PRECO_UNIT NUMERIC(12, 2) NOT NULL
    , PRECO_BRUTO NUMERIC(12, 2) NOT NULL

    , DESCONTO NUMERIC(12, 2) NOT NULL
    , PRECO NUMERIC(12, 2) NOT NULL
  );
END^

RECREATE PACKAGE BODY VENDA_INICIAL_PA
AS
BEGIN
  PROCEDURE VENDA_GAR
  (
    LOJA_ID ID_SHORT_DOM NOT NULL
    , TERMINAL_ID ID_SHORT_DOM NOT NULL
    , EST_MOV_ID BIGINT NOT NULL

    , VENDA_ID ID_DOM NOT NULL

    , SESS_LOJA_ID ID_SHORT_DOM NOT NULL
    , SESS_TERMINAL_ID ID_SHORT_DOM NOT NULL
    , SESS_ID ID_DOM NOT NULL

    , C VARCHAR(15) NOT NULL

    , CLIENTE_LOJA_ID ID_SHORT_DOM NOT NULL
    , CLIENTE_TERMINAL_ID ID_SHORT_DOM NOT NULL
    , CLIENTE_ID ID_DOM NOT NULL

    , ENDERECO_LOJA_ID ID_SHORT_DOM NOT NULL
    , ENDERECO_TERMINAL_ID ID_SHORT_DOM NOT NULL
    , ENDERECO_ID ID_DOM NOT NULL

    , DESCONTO_TOTAL NUMERIC(12, 2) NOT NULL
    , CUSTO_TOTAL NUMERIC(12, 2) NOT NULL
    , TOTAL_LIQUIDO NUMERIC(12, 2) NOT NULL

    , ENTREGA_TEM BOOLEAN NOT NULL
    , ENTREGADOR_PESSOA_ID ID_DOM NOT NULL
    , ENTREGA_DTH TIMESTAMP NOT NULL

    , ALTERADO_EM TIMESTAMP NOT NULL
  )
  AS
  BEGIN
    UPDATE OR INSERT INTO VENDA
    (
      LOJA_ID
      , TERMINAL_ID
      , EST_MOV_ID

      , VENDA_ID

      , SESS_LOJA_ID
      , SESS_TERMINAL_ID
      , SESS_ID

      , C

      , CLIENTE_LOJA_ID
      , CLIENTE_TERMINAL_ID
      , CLIENTE_ID

      , ENDERECO_LOJA_ID
      , ENDERECO_TERMINAL_ID
      , ENDERECO_ID

      , DESCONTO_TOTAL
      , CUSTO_TOTAL
      , TOTAL_LIQUIDO

      , ENTREGA_TEM
      , ENTREGADOR_PESSOA_ID
      , ENTREGA_DTH

      , ALTERADO_EM
    )
    VALUES
    (
      :LOJA_ID
      , :TERMINAL_ID
      , :EST_MOV_ID

      , :VENDA_ID

      , :SESS_LOJA_ID
      , :SESS_TERMINAL_ID
      , :SESS_ID

      , :C

      , :CLIENTE_LOJA_ID
      , :CLIENTE_TERMINAL_ID
      , :CLIENTE_ID

      , :ENDERECO_LOJA_ID
      , :ENDERECO_TERMINAL_ID
      , :ENDERECO_ID

      , :DESCONTO_TOTAL
      , :CUSTO_TOTAL
      , :TOTAL_LIQUIDO

      , :ENTREGA_TEM
      , :ENTREGADOR_PESSOA_ID
      , :ENTREGA_DTH

      , :ALTERADO_EM
    )
    MATCHING
    (
      LOJA_ID
      , TERMINAL_ID
      , EST_MOV_ID
    );
  END
  
  PROCEDURE VENDA_ITEM_GAR
  (
    LOJA_ID ID_SHORT_DOM NOT NULL
    , TERMINAL_ID ID_SHORT_DOM NOT NULL
    , EST_MOV_ID BIGINT NOT NULL
    , EST_MOV_ITEM_ORDEM SMALLINT NOT NULL

    , CUSTO_UNIT NUMERIC(12, 4) NOT NULL
    , CUSTO NUMERIC(12, 2) NOT NULL

    , PRECO_UNIT_ORIGINAL NUMERIC(12, 2) NOT NULL
    , PRECO_UNIT_PROMO NUMERIC(12, 2) NOT NULL
    , PRECO_UNIT NUMERIC(12, 2) NOT NULL
    , PRECO_BRUTO NUMERIC(12, 2) NOT NULL

    , DESCONTO NUMERIC(12, 2) NOT NULL
    , PRECO NUMERIC(12, 2) NOT NULL
  )
  AS
  BEGIN
    UPDATE OR INSERT INTO VENDA_ITEM
    (
      LOJA_ID
      , TERMINAL_ID
      , EST_MOV_ID
      , EST_MOV_ITEM_ORDEM

      , CUSTO_UNIT
      , CUSTO

      , PRECO_UNIT_ORIGINAL
      , PRECO_UNIT_PROMO
      , PRECO_UNIT
      , PRECO_BRUTO

      , DESCONTO
      , PRECO
    )
    VALUES
    (
      :LOJA_ID
      , :TERMINAL_ID
      , :EST_MOV_ID
      , :EST_MOV_ITEM_ORDEM

      , :CUSTO_UNIT
      , :CUSTO

      , :PRECO_UNIT_ORIGINAL
      , :PRECO_UNIT_PROMO
      , :PRECO_UNIT
      , :PRECO_BRUTO

      , :DESCONTO
      , :PRECO
    )
    MATCHING
    (
      LOJA_ID
      , TERMINAL_ID
      , EST_MOV_ID
      , EST_MOV_ITEM_ORDEM
    );
  END
END^
SET TERM ;^
```
COMANDO FIM

DBATUALIZ FIM
